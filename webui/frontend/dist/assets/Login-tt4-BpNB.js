import{d as U,r as p,o as D,c as i,a as k,b as a,l as E,F as h,e as o,w as s,f as c,t as F,n as R,i as L,h as z,E as l,j as M,k as S,u as A,g as u,_ as H}from"./index-X1O1lxeu.js";const G={class:"login-page"},I={class:"form-section"},Z={key:0},$={key:1},q={class:"forgot-link"},J={class:"form-section"},O={key:0},Q={key:1},W={class:"recovery-section"},X={class:"key-display"},Y=U({__name:"Login",setup(ee){const j=A(),d=p(!1),w=p(""),C=p(!1),v=p("login"),t=p({recoveryKey:"",newPassword:"",confirmPassword:""}),f=p(""),V=async()=>{if(!w.value){l.error("请输入密码");return}d.value=!0;try{const r=await M.login(w.value);r.code===0?(S(r.data.token),j.replace("/")):(l.error(r.msg),d.value=!1)}catch(r){console.error("登录失败:",r),l.error("网络请求失败"),d.value=!1}},x=async()=>{if(!t.value.recoveryKey){l.error("请输入恢复密钥");return}if(!t.value.newPassword){l.error("请输入新密码");return}if(t.value.newPassword.length<6){l.error("密码长度至少 6 位");return}if(t.value.newPassword!==t.value.confirmPassword){l.error("两次密码输入不一致");return}d.value=!0;try{const r=await M.resetPassword(t.value.recoveryKey,t.value.newPassword);r.code===0?(f.value=r.data.recovery_key,v.value="reset_success",l.success("密码重置成功")):l.error(r.msg)}catch{l.error("网络请求失败")}finally{d.value=!1}},B=async()=>{try{await navigator.clipboard.writeText(f.value),l.success("已复制到剪贴板")}catch{l.error("复制失败，请手动复制")}},P=()=>{v.value="login",w.value="",t.value={recoveryKey:"",newPassword:"",confirmPassword:""},f.value=""};return D(()=>{setTimeout(()=>{C.value=!0},100)}),(r,e)=>{const _=c("Lock"),m=c("el-icon"),y=c("el-input"),g=c("el-form-item"),b=c("el-button"),K=c("el-form"),T=c("Key"),N=c("DocumentCopy");return u(),i("div",G,[e[12]||(e[12]=k('<div class="bg-decoration" data-v-3ddeb65d><div class="circle circle-1" data-v-3ddeb65d></div><div class="circle circle-2" data-v-3ddeb65d></div><div class="circle circle-3" data-v-3ddeb65d></div><div class="grid-pattern" data-v-3ddeb65d></div></div>',1)),a("div",{class:R(["login-card",{"card-visible":C.value}])},[v.value==="login"?(u(),i(h,{key:0},[e[5]||(e[5]=k('<div class="logo-section" data-v-3ddeb65d><div class="logo-icon" data-v-3ddeb65d><svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-3ddeb65d><path d="M24 4L4 14V34L24 44L44 34V14L24 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-3ddeb65d></path><path d="M4 14L24 24L44 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-3ddeb65d></path><path d="M24 24V44" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-3ddeb65d></path><circle cx="24" cy="24" r="6" stroke="currentColor" stroke-width="2" data-v-3ddeb65d></circle></svg></div><h1 class="title" data-v-3ddeb65d>Relay</h1><p class="subtitle" data-v-3ddeb65d>TCP/UDP 端口转发管理平台</p></div>',1)),a("div",I,[o(K,{"label-position":"top"},{default:s(()=>[o(g,{label:"管理员密码"},{default:s(()=>[o(y,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=n=>w.value=n),type:"password",placeholder:"请输入密码",size:"large","show-password":"",onKeyup:L(V,["enter"])},{prefix:s(()=>[o(m,null,{default:s(()=>[o(_)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(b,{type:"primary",size:"large",loading:d.value,disabled:d.value,onClick:V,class:"login-btn"},{default:s(()=>[d.value?(u(),i("span",$,"登录中...")):(u(),i("span",Z,"登 录"))]),_:1},8,["loading","disabled"])]),_:1})]),a("div",q,[a("a",{onClick:e[1]||(e[1]=n=>v.value="reset")},"忘记密码？")])],64)):v.value==="reset"?(u(),i(h,{key:1},[e[6]||(e[6]=k('<div class="logo-section" data-v-3ddeb65d><div class="logo-icon reset-icon" data-v-3ddeb65d><svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-3ddeb65d><path d="M20 16H12V8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-3ddeb65d></path><path d="M12 16C14.5-11.5 19-8 24-8C32.8-8 40 -0.8 40 8V8C40 16.8 32.8 24 24 24C19 24 14.5 21.5 12 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" transform="translate(0 16)" data-v-3ddeb65d></path></svg></div><h1 class="title" data-v-3ddeb65d>重置密码</h1><p class="subtitle" data-v-3ddeb65d>输入恢复密钥以重置管理员密码</p></div>',1)),a("div",J,[o(K,{"label-position":"top"},{default:s(()=>[o(g,{label:"恢复密钥"},{default:s(()=>[o(y,{modelValue:t.value.recoveryKey,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.recoveryKey=n),placeholder:"请输入恢复密钥",size:"large",class:"mono-input"},{prefix:s(()=>[o(m,null,{default:s(()=>[o(T)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(g,{label:"新密码"},{default:s(()=>[o(y,{modelValue:t.value.newPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>t.value.newPassword=n),type:"password",placeholder:"请输入新密码 (至少 6 位)",size:"large","show-password":""},{prefix:s(()=>[o(m,null,{default:s(()=>[o(_)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(g,{label:"确认新密码"},{default:s(()=>[o(y,{modelValue:t.value.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=n=>t.value.confirmPassword=n),type:"password",placeholder:"请再次输入新密码",size:"large","show-password":"",onKeyup:L(x,["enter"])},{prefix:s(()=>[o(m,null,{default:s(()=>[o(_)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(b,{type:"primary",size:"large",loading:d.value,disabled:d.value,onClick:x,class:"login-btn"},{default:s(()=>[d.value?(u(),i("span",Q,"重置中...")):(u(),i("span",O,"重置密码"))]),_:1},8,["loading","disabled"])]),_:1})]),a("div",{class:"forgot-link"},[a("a",{onClick:P},"返回登录")])],64)):v.value==="reset_success"?(u(),i(h,{key:2},[e[10]||(e[10]=k('<div class="logo-section" data-v-3ddeb65d><div class="logo-icon success-icon" data-v-3ddeb65d><svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-3ddeb65d><path d="M20 25L23 28L30 20" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" data-v-3ddeb65d></path><circle cx="24" cy="24" r="18" stroke="currentColor" stroke-width="2" data-v-3ddeb65d></circle></svg></div><h1 class="title" data-v-3ddeb65d>密码已重置</h1><p class="subtitle" data-v-3ddeb65d>请保存新的恢复密钥，旧密钥已失效</p></div>',1)),a("div",W,[e[9]||(e[9]=a("div",{class:"warning-box"},[a("svg",{class:"warning-icon",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),a("span",null,"此密钥仅显示一次，关闭后无法再次查看！")],-1)),a("div",X,[a("code",null,F(f.value),1)]),o(b,{type:"primary",class:"copy-btn",onClick:B},{default:s(()=>[o(m,null,{default:s(()=>[o(N)]),_:1}),e[7]||(e[7]=z(" 复制密钥 ",-1))]),_:1}),o(b,{type:"primary",size:"large",onClick:P,class:"login-btn"},{default:s(()=>[...e[8]||(e[8]=[z(" 返回登录 ",-1)])]),_:1})])],64)):E("",!0),e[11]||(e[11]=a("div",{class:"footer-info"},[a("span",null,"Secure Access Gateway")],-1))],2)])}}}),se=H(Y,[["__scopeId","data-v-3ddeb65d"]]);export{se as default};
